def configFileName
switch (params.BUILD) {
    case 'test1':
        configFileName = 'config_test1.groovy'
        break
    case 'test2':
        configFileName = 'config_test2.groovy'
        break
}

def config

node {
    // Клонируем репозиторий Git
    git branch: 'main', url: 'https://github.com/spider2111/conf.test.git'
    
    // Загружаем файлы конфигурации
    config = load configFileName

    // Отладочный вывод, чтобы убедиться, что файл конфигурации успешно загружен
    echo "Configuration file loaded: ${configFileName}"
    println "Contents of configuration file:"
    println config.getClass()
    println config

    // Проверяем, что config является объектом, а не строкой
    if (config instanceof Map) {
        echo "PROJECT_NAME: ${config.PROJECT_NAME}"
    } else {
        echo "config is not a map, it is ${config.getClass()}"
    }
}

pipeline {
    agent any

    stages {
        stage('Example') {
            steps {
                script {
                    // Отладочный вывод, чтобы убедиться, что файл конфигурации успешно загружен
                    echo "Configuration file loaded: ${configFileName}"
                    println config 
                    echo "Contents of configuration file:"
                    echo config
                    // Берем переменнные из config файлов
                    echo "PROJECT_NAME: ${config.PROJECT_NAME}"
                }
            }
        }
    }
}