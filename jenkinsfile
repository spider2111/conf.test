import groovy.json.JsonSlurper
def configFileName

switch (params.BUILD) {
    case 'test1':
        configFileName = 'config_test1.json'
        break
    case 'test2':
        configFileName = 'config_test2.json'
        break
}

pipeline {
    agent any

    stages {
        stage('Read Config') {
            steps {
                script {
                    // Read the content of the JSON file
                    def configFileContent = readFile(configFileName)
                    // Parse the JSON content using JsonSlurper
                    def jsonSlurper = new groovy.json.JsonSlurper()
                    def config = jsonSlurper.parseText(configFileContent)

                    // Debug output to ensure that the configuration file is loaded successfully
                    echo "Configuration file loaded: ${configFileName}"
                    echo "Contents of configuration file:"
                    echo "PROJECT_NAME: ${config.PROJECT_NAME}"
                    echo "AGENT: ${config.AGENT}"
                    // Store the parsed configuration in an environment variable
                    env.CONFIG = configFileContent
                }
            }
        }

        stage('Example') {
            steps {
                script {
                    // Retrieve the parsed configuration from the environment variable
                    def config = new groovy.json.JsonSlurper().parseText(env.CONFIG)
                    // Print the variables from the config file
                    echo "PROJECT_NAME: ${config.PROJECT_NAME}"
                    echo "AGENT: ${config.AGENT}"
                }
            }
        }
    }
}
